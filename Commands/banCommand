package me.ModMakerGroup.SM.Commands;

import java.io.File;

import me.ModMakerGroup.SM.ServerManager;

import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.OfflinePlayer;
import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.configuration.file.YamlConfiguration;
import org.bukkit.entity.Player;

public class banCommand implements CommandExecutor{

	  ServerManager main;
	  public banCommand(ServerManager plugin)
	  {
	    this.main = plugin;
	  }
	
	@SuppressWarnings("deprecation")
	@Override
	public boolean onCommand(CommandSender cs, Command cmd, String label, String[] args) {
		if (cmd.getName().equalsIgnoreCase("ban")) {
			if (cs instanceof Player) {
				Player p = (Player)cs;
				if ((p != null) && (!p.hasPermission("sm.ban"))) {
					p.sendMessage("§4[§1SM§4]: " + ServerManager.KeineRechte);
					return true;
				}else{
					if (args.length > 0) {
						OfflinePlayer target = Bukkit.getOfflinePlayer(args[0]);
						Player otarget = Bukkit.getPlayer(args[0]);
							if (target != null) {
								if (args.length == 2) {
									String ban = args[1];
									target.setBanned(true);
										if (otarget != null) {
											otarget.kickPlayer(ban);
										}
		              if (this.main.getConfig().getBoolean("General.Broadcast message ban", true)) {
		            	  Bukkit.broadcastMessage("§l§7[§4!§7]: §r§4" + target.getName() + " was banned by " + cs.getName() + "!");
		            	  Bukkit.broadcastMessage("§l§7[§4!§7]: §r§4Reason: " + ban);

		              }		                
		            } else {
		              target.setBanned(true);	              
	            	  if (otarget != null) {
		                otarget.kickPlayer("Banned from the server!");
		              }
	            	  Bukkit.broadcastMessage("§l§7[§4!§7]: §r§4" + target.getName() + " was banned by " + cs.getName() + "!");
		             }
		          }
		            return true;
		          }else{
			          cs.sendMessage("§l§7[§4!§7]:§r The Player was not found!");
			          return true;
		          }
				}
			}
			
		}
		if (cmd.getName().equalsIgnoreCase("unban")) {
			File file = null;
	    	if (main.getConfig().getString("General.Language").equals("en_EN")) {
	    		file = new File("plugins/ServerManager/Languages", "en_EN.yml");
	    	} else if (main.getConfig().getString("General.Language").equals("de_DE")) {
	    		file = new File("plugins/ServerManager/Languages", "de_DE.yml");
	    	} else if (main.getConfig().getString("General.Language").equals("es_ES")) {
	    		file = new File("plugins/ServerManager/Languages", "es_ES.yml");
	    	}
	    	FileConfiguration cfgm = YamlConfiguration.loadConfiguration(file);	    	
	    	if ((cs instanceof Player)) {
		          Player p = (Player)cs;
		          if ((p != null) && (!p.hasPermission("sm.unban"))) {
		        	  p.sendMessage("§4[§1SM§4]: " + ServerManager.KeineRechte);
		        	  return true;
					}else{
		        if (args.length > 0) {
		          OfflinePlayer target = Bukkit.getPlayer(args[0]);
		          if (target == null) {
		            target = Bukkit.getOfflinePlayer(args[0]);
		          }

		          if (target != null) {
		            if (target.isBanned()) {
		            	target.setBanned(false);
		                String unban = cfgm.getString("Ban.Unbanmessage");
		                unban = ChatColor.translateAlternateColorCodes('&', unban);
		                unban = unban.replace("%player%", target.getName());
		                cs.sendMessage(ServerManager.prefixb + unban);
		            } else {
		                String nB = cfgm.getString("Ban.Not Banned");
		                nB = ChatColor.translateAlternateColorCodes('&', nB);
		                nB = nB.replace("%player%", target.getName());
		                cs.sendMessage(ServerManager.prefixb + nB);
		            }
		            return true;
		          }
		          cs.sendMessage("§l§7[§4!§7]:§r The Player was not found!");
		          return true;
		        }
		    }
		}
		}
		return true;
	}

}
